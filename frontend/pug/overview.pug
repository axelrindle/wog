extends layout.pug

block content
  // overlay
  div#fader
  
  // container
  div#app
  
    //sidebar
    div#sidebar
    
      // header
      section.section
        .container
          a(href=path("about"))
            img(src=path("img/header.png"))
          
      hr.bottom
    
      // filter
      section.section
        .container
          include overview/sidebar_filter.pug
      
      hr
      
      // file tree
      section.section
        .container
          include overview/sidebar_file_tree.pug
    
    // content
    div#content
    
      // options card
      .card
        header.card-header
          p.card-header-title
            span(v-if="selected !== -1").subtitle.is-6 {{ files[selected].path }}&nbsp;&nbsp;|&nbsp;&nbsp;
            | Options
          
          // Refreshed indicator
          p.pointer(style="padding: .75rem;" v-if="showRefreshedIndicator")
            span.has-text-success.icon(title="File updated.")
              i.far.fa-bell.fa-lg
                
          // No socket connection indicator
          p.pointer(style="padding: .75rem;" v-if="socket === null")
            span.has-text-danger.icon(title="Automatic refresh disabled!")
              i.fas.fa-exclamation-triangle.fa-lg
        .card-content
          .content
            .columns
                
              // grep / fuzzy search
              .column
                include overview/log_filter.pug
              
              // actions
              .column
                include overview/log_actions.pug
                
              // info
              .column
                include overview/log_info.pug
      
      // actual log content
      pre#logContent(v-if="error === '' && !isLoading")
        code
          div(v-for="(line, index) in linesFiltered" :data-line="index + 1") {{ index + 1}}: {{ line }}
      pre(v-else)
        code.has-text-danger(v-if="error !== ''") {{ error }}
        code.loading(v-else)
          span(style="margin-right: 10px;") Loading...
          i.fas.fa-sync-alt.fa-spin.fa-lg

    // Modals
    .modal#goToLineModal
      .modal-background
      .modal-card
        header.modal-card-head
          p.modal-card-title Go to line
          button.button.is-danger.is-rounded(@click="closeGoToLine") X
        
        section.modal-card-body
          .field
            label.label Enter the line number you want to jump to
            .control
              input.input(type='number', min="1" :max="filteredLinesAmount"
                          v-model="lineToGoTo"
                          @keyup.enter="goToLine"
                          @keyup.esc="closeGoToLine")
            .span.has-text-danger(v-if="showGoToLineError()") Must not be bigger than {{ filteredLinesAmount }}!

        footer.modal-card-foot
          button.button.is-success(@click="goToLine" :disabled="showGoToLineError()") Go
          button.button(@click="closeGoToLine") Cancel


block js
  if !debug
    script(src=path("vendor/vue.min.js"))
  else
    script(src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js")
  script(src=path("vendor/axios.min.js"))
  script(src=path("vendor/jquery-3.3.1.min.js"))
  //script(src=path("vendor/jquery.mCustomScrollbar.concat.min.js"))
  script(src=path("js/logic.js"))
